<!-- =========================
‚úÖ FULL HTML (reseller.html) ‚Äî 100% WORK
========================= --><!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Xemz Panel Creator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen px-4">  <div class="max-w-md w-full bg-white/10 p-6 rounded-2xl shadow-xl">
    <h1 class="text-xl font-bold text-center mb-4">üöÄ Buat Panel Pterodactyl</h1><input id="panelName" type="text" placeholder="Nama Panel" class="w-full mb-4 px-4 py-2 rounded bg-white/20 placeholder-white text-white">
<select id="panelPlan" class="w-full mb-4 px-4 py-2 rounded bg-white/20 text-white">
  <option value="">-- Pilih Plan --</option>
  <option value="1gb">1 GB</option>
  <option value="2gb">2 GB</option>
</select>

<button id="createBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded">Create Panel</button>

<pre id="result" class="mt-4 text-sm hidden whitespace-pre-wrap"></pre>

  </div>  <script>
    const planConfig = {
      "1gb": { ram: 1024, disk: 2048, cpu: 50 },
      "2gb": { ram: 2048, disk: 4096, cpu: 80 }
    };

    document.getElementById('createBtn').onclick = async () => {
      const name = document.getElementById('panelName').value.trim();
      const plan = document.getElementById('panelPlan').value;
      const resDiv = document.getElementById('result');
      resDiv.classList.add('hidden');

      if (!name || !planConfig[plan]) {
        resDiv.textContent = "‚ùå Isi semua field dengan benar";
        resDiv.classList.remove('hidden');
        return;
      }

      const specs = planConfig[plan];
      const username = name.toLowerCase().replace(/\s+/g, '') + Date.now();
      const email = `${username}@xemz.id`;
      const password = username + "123";

      try {
        resDiv.textContent = "‚è≥ Membuat user...";
        resDiv.classList.remove('hidden');

        const userRes = await fetch('/api/relay', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'create_user',
            payload: {
              email,
              username,
              first_name: name,
              last_name: "User",
              password
            }
          })
        });

        const userJson = await userRes.json();
        if (!userJson.success) throw new Error(JSON.stringify(userJson));
        const userId = userJson.data.attributes.id;

        resDiv.textContent += "\n‚úÖ User dibuat. Membuat server...";

        const serverRes = await fetch('/api/relay', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'create_server',
            payload: {
              name: name + "-server",
              user: userId,
              egg: 15,
              nest: 5,
              docker_image: "ghcr.io/parkervcp/yolks:nodejs_18",
              startup: "npm start",
              limits: specs,
              feature_limits: { databases: 1, backups: 1, allocations: 1 },
              deploy: { locations: [1], dedicated_ip: false, port_range: [] },
              environment: {
                INST: "npm",
                USER_UPLOAD: "0",
                AUTO_UPDATE: "0",
                CMD_RUN: "npm start"
              }
            }
          })
        });

        const serverJson = await serverRes.json();
        if (!serverJson.success) throw new Error(JSON.stringify(serverJson));

        resDiv.textContent += `\n‚úÖ Server dibuat!\nüë§ Username: ${username}\nüìß Email: ${email}\nüîë Password: ${password}`;

      } catch (err) {
        resDiv.textContent = "‚ùå Gagal: " + err.message;
        resDiv.classList.remove('hidden');
      }
    };
  </script></body>
</html>
